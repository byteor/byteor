<script src="http://cdn.pubnub.com/pubnub-3.14.4.min.js"></script>
<script>
 var scource = "{{.Email}}";
 pubnub = PUBNUM({
     publish_key: '{{.PubKey}}',
     subscribe_key: '{{.SubKey}}'
 });

 console.log("Subscribing...");

 pubnub.subscribe({
     channel: "hello_world",
     message: function(message, envelope, channelOrGroup, time, channel) {
	 console.log(
	     "Message Received." + "\n" +
	     "Channel or Group: " + JSON.stringify(channelOrGroup) + "\n" +
	     "Channel: " + JSON.stringify(channel) + "\n" +
	     "Time: " + time + "\n" +
	     "Raw Envelope: " + JSON.stringify(evelope)
	 );
	 var newDiv = document.createElement('div');
	 newDiv.innerHTML = message;
	 var oldDiv = document.getElementById('chatLog');
	 oldDiv.appendChild(newDiv);
     },
     connect: pub
 });

 func pub(txt) {
     console.log("About to publish: " + txt);
     pubnub.publish({
	 channel: "hello_world",
	 message: "[" + source + "]: " + txt,
	 callback: function(m) {console.log(m);}
     });
 }

 function publish() {
     console.log("Going to publish on demand");
     txt = document.getElementById("theText").value;
     pub(txt);
 }
</script>
